色彩管理，这个词已经越来越多的出现在了我们身边，只要平时有关注硬件的话，肯定都对它有印象，但是色彩管理究竟是什么，从这段时间各种平台的留言或者「科普」来看，依然有很多人对它并不了解，但是随着 5G 的普及，用户对于图片和视频的质量要求也越来越高，所以给手机增加完善的色彩管理刻不容缓。

在11 月 18 日 OPPO INNODAY 的技术分论坛上，OPPO 第一次对外讲述了它的「全链路色彩管理系统」，我也一直在现场听完了全部内容，所以也借着这一个机会梳理一下色彩管理的诞生、原理和效果，然后在看看 OPPO 的全链路色彩管理系到底做到了哪一步，对于消费者来说有什么作用。

## 为什么需要色彩管理？

显示设备的终极目标只有一个，那就是忠实地还原真实的视觉效果。

那么究竟是什么决定了我们能不能看到准确的画面呢？很多人可能会说：我知道色准的概念，ΔE 或者 JNCD 越低那么屏幕的偏色就越小。是的，这个概念很容易被理解，一块屏幕的色准表现越好，也就能越准确的显示出我们给它输入的 RGB 值。

比如说 OPPO 今年年初发布的旗舰 Find X2 系列，就拥有着广告法不让说级别的超高色准表现，我们也都有相应的评测。

但需要注意的是，在上边我说的是 RGB 值，而不是「屏幕的色准表现越好，也就能越准确的显示我们想要让它显示的颜色」，这是有区别的，而且这个区别还真不小。

现代设备的显示原理都基于 RGB, 但是不同屏幕的色域覆盖不同，所以同样的 RGB 数值，在不同的设备上显示出的颜色也就是不一样的，我们模拟了一下在没有色彩管理时用 P3 色域屏幕显示 sRGB 内容的样子：

![](image/bffb20cdd3137e2542a25492f567e06c.jpeg)
你可以很明显的看出来，由于 P3 能显示更鲜艳的颜色，所以画面的整体饱和度也都被拉高了，右边的色偏示意图各种报警，这显然不是我们想要的。
![](image/fdaa01d030273a3963a67aa3c35b1439.jpeg)

所以如果你在手机看到一张图片的饱和度明显有增加，特别是红色和绿色，那么大概率就是因为 sRGB 的图片被显示在 P3 了。
![](image/b582be5224ede7b7c52035b72486c85f.jpeg)
而如果我们能对内容的色彩空间进行识别，然后根据屏幕色自动切换，就能在 P3 的屏幕上正确的显示 sRGB 的内容，这就是我们常说的狭义上的色彩管理。

## 光解决显示还不够全面，因为手机离不开拍摄

对于手机来说，早些年拍摄的照片都是用 sRGB 来记录的，随着后来手机屏幕逐渐普及 P3 标准，如果我们继续以 sRGB 记录照片的话，鲜艳的屏幕颜色就显得有些浪费，所以为了与之相匹配， 2018 年 Find X 就成了 OPPO 第一款支持以 P3 记录照片的手机，让你不仅能看，也能拍。

而现在手机屏幕的标准又一次被提高，Find X2 系列的屏幕除了支持了 P3 色域覆盖之外，还有一个大提升就在于 10bit 色深以及 HDR10+ 显示，那么手机拍摄和存储的流程自然也需要同步进化。

从 Find X2 系列开始，OPPO 已经拥有了拍摄 10bit 图片和视频的能力，10bit 代表的是色深，也就是色彩的细腻程度。


之前我们打过一个比方：色域越高可以类比成导弹的射程越远，而色深则可以理解为导弹的精度有多高。

![](image/cf7a560fe477e68ce9d914215389028e.jpeg)

比如说上边这幅图，我们可以把中间的白点理解成导弹发射基地，而 RGB 三个极值圈出的三角形就是射程范围（色域），上边的方框则代表当前级精度下导弹能击中的位置（显示的颜色）。

这是一个 2bit的系统，所以从白色到 RGB 的每条路线都只能提供 2^2 也就是 4 个精度的坐标，每一个坐标之间的距离很远（颜色差距很大），即便是我们混合使用 RGB 个方向去描述坐标（显示颜色）一共也只能得到 4*4*4=64 个坐标。

![](image/46a8477023d1070c83127f4cac9a9062.jpeg)


更直观一点，我们把上边的原图转换成 2bit 之后，能发现颜色之间的过度出现了明显的问题，原本有很多层次的灰色变成了三层，这就是色深不足带来的最明显缺点。

![](image/cafcf5c542f8d682f397cfb7912b4574.jpeg)

10bit 意味着 RGB 的每一个通道都可以记录 2^10=1024 个等级，相对于 8bit 的 2^8=256 个等级就提升了 4 倍，从 8bit 到 10bit 也就是 RGB 每个通道提升 4 倍，所以能表示颜色的精确程度也就提升了 4*4*4=64 倍，能显示出超过 10 亿种颜色

**当然，你也可以说 8bit 的照片看起来都蛮好的，实话实说确实不错，但要注意的是 8bit 看起来不错的原因在于你只是看而并没有调节：**

![](image/8c65f25fd740cef1a9b3166e37857717.jpeg)

有的时候你在手机上修图，稍微调一下饱和度或者明暗就会到颜色出现了奇怪的断层，这也就是 8bit 色深不够造成的，所以 10bit 的加入，还能让 OPPO 拍下的照片在修图时拥有更大的可能性。

配合 10bit 全链路，OPPO 也首发了硬件级的堆栈式 DOL-HDR 技术：
![](image/36489898744aebbc8b5a417a6fb8e190.png)

无论是手机还是相机，拍摄多张/多帧不同曝光的图片然后合成一张/一帧 HDR 图片/视频，其实大家都见怪不怪了，但这样的方法仅仅适用于没有移动的画面，否则就会出现鬼影。

而 DOL-HDR 能在硬件上利用 CMOS 的不同像素在同一时间完成长中短曝光帧的连续输出，也就是说它拥有天然的动态范围优势，不同曝光帧之间的时间差要比普通 HDR 大大减少，也就能避免鬼影，还拥有更高的信噪比。

## 全链路，全在哪？

我们刚刚已经提到过，OPPO 现在从硬件上已经做到了：

  * 屏幕能以 10bit 显示 P3 色域
  * 相机能以 10bit 记录 P3 色彩

在最前端和最后端的硬件规格提升之后，软件处理自然也不能落下，因为色彩管理最终的效果取决于最短板，只要有一个环节达不到标准就会前功尽弃。

**所以 OPPO 这一次提出的全链路色彩管理系统，是包括了拍摄->运算->编码->存储->解码->显示的整个流程，** 这也就是为什么 OPPO 一直强调全链路，因为它是从影像被记录一直到显示，设计硬件与软件的完整流程，比仅仅包含色域映射的狭义色彩管理更加复杂。

**在完成图像信息的采集之后，第一个难关首先来自于存储：**

我们所熟知的 JPEG 格式原本只能记录 8bit 的图像（在很小的一部分情况下可以记录 12bit 图像），但也意味着文件体积的巨量增加，所以 10bit 在带来 64 倍色彩精度的同时，我们也需要找到一个更加高效的文件格式。
![](image/63169a561fa38d0c68839a82c3717b97.jpeg)

OPPO 的选择是将图片格式切换到 HEIF, 它的全称是 High Efficiency Image File Format，中文名字「高效图像文件格式」，它的压缩算法和高效视频压缩格式（HEVC/H.265）同源，最高支持 16bit, 只需要 50% 的体积就能实现一样的画质。

除此之外它还能无缝融合 HDR, 支持广色域, 能存储透明图层，景深信息还有动态的图像和音频，可以说 HEIF 就是目前最先进的图片格式了。

**接着我们需要给图片一个「身份证」：**
![](image/d33a395711252e8537318b38df80b7d0.jpeg)

在这一步，OPPO 将会把图片的 ICC Profile 嵌入，ICC Profile 内包含了图片是以什么色彩空间记录的，这样支持色彩管理的应用和系统就能识别它的色彩空间，并且判断屏幕的色域和对它进行处理，最终就能实现 OPPO 相册/第三方相册的色彩管理，保证系统能做出最正确的色彩映射。

这也带来了一个附加的功能，因为整个系统都支持色彩管理，所以也就能针对色盲或者色弱人群定向和定量的进行广色域的色域/色彩补偿，比如面向黄绿色弱可以通过增强红色像素的方式帮助这类用户区分黄色和绿色，让他们也能享受到科技带来的进步。

**还有不可忽视的一点是解码和渲染：**

我们实话实说，OPPO 并不是第一家用 HEFI 的厂商，但是有的厂商用了 HEIF却不支持 10bit, 这其中的原因就在于 Android 底层系统只支持8bit图片解码，所以在启始解码阶段，10bit数据就无法被正确处理。
![](image/b3695b5407901039ad30d7738234ce48.jpeg)

而 OPPO 为了实现全链路 10bit, 就率先对原生 Android 的解码进行了重构，同时对原生的内存数据进行改造，还增加了渲染适配入口，最终研发出了兼容10bit图片的解决方案，这也是 OPPO 在全链路 10bit 上的领先之处。

## 尾声：

互联网上常说的色彩管理，其实都是狭义上的色彩管理，基本只包含了色彩映射这一个环节，也就根据内容的色彩空间和屏幕的色域来匹配色彩。

但是 OPPO 定义的色彩管理要更加全面一些，它不仅仅包含颜色，也考虑到了 10bit 的记录，存储和还原。

这也就是为什么我们开头说 OPPO 的全链路色彩管理不只是色彩映射，因为它还包括拍摄+运算+编码+存储+显示，在这些流程中都能保留 10bit + 广色域的信息不被曲解或者丢失。

![](image/76253cfee40ab9ed930cbad20d1accb0.jpeg)

**特别是 10bit, 其他厂商可能也有 10bit 的屏幕，或者能拍摄 10bit 的视频，但是目前为止 OPPO 是唯一实现了从拍摄到显示的全流程都支持 10bit 的厂商，也是 OPPO 全链路色彩管理最特别和领先的地方.**

之前有不少观点提到：Android 手机给了好硬件但是没有软件支撑。

不可否认确实有这样的情况存在过，但现在 OPPO 愿意在这方面投入，推出了 Android 首个全链路色彩管理系统，也算是指出了一条方向，而且还能为今后更广色域，更高色深的视频或者图片内容发展提供支持，是百利而无一害的。

其实再广义一点的说，提供超高色准的硬件，也可以被算作色彩管理的一部分，因为无论是叫「全链路」又或者是其他的名字，最终极的目的只有一个：

让用户拍到/看到真实且更加丰富多彩的世界

![](image/e9fb3eb72ddaa849d24fcbce6d436956.jpeg)

而这一切，都将会出现在 OPPO 未来的旗舰 Find X3 系列上，如果条件允许，其他的产品也都可以享受到全链路色彩管理带来的新体验。
